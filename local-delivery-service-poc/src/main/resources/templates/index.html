<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Local Delivery Service POC</title>
    <style>
        :root {
            --ink: #111827;
            --muted: #475569;
            --accent: #f97316;
            --accent-dark: #ea580c;
            --accent-soft: #ffedd5;
            --bg: radial-gradient(circle at 10% 20%, rgba(255, 237, 213, 0.75), transparent 45%),
                  radial-gradient(circle at 80% 0%, rgba(226, 232, 240, 0.9), transparent 38%),
                  linear-gradient(140deg, #f8fafc 0%, #e2e8f0 100%);
            --card: #ffffff;
            --shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: "Space Grotesk", "IBM Plex Sans", "Segoe UI", system-ui, sans-serif; background: var(--bg); color: var(--ink); }
        .page { max-width: 1200px; margin: 0 auto; padding: 32px 20px 60px; }
        .hero { background: var(--card); border-radius: 22px; padding: 28px 30px; box-shadow: var(--shadow); animation: floatIn 0.6s ease both; }
        .hero h1 { margin: 0 0 8px; font-size: 34px; }
        .hero p { margin: 0; color: var(--muted); max-width: 640px; }
        .badge { display: inline-flex; align-items: center; gap: 8px; margin-top: 14px; padding: 6px 12px; border-radius: 999px; background: var(--accent-soft); color: #9a3412; font-weight: 600; font-size: 13px; }
        .grid { display: grid; gap: 20px; margin-top: 24px; }
        .grid.two { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
        .grid.three { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
        .card { background: var(--card); border-radius: 18px; padding: 20px 22px; box-shadow: var(--shadow); animation: floatIn 0.7s ease both; }
        .card h2 { margin: 0 0 10px; font-size: 20px; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-top: 16px; }
        .metric { background: #f8fafc; border-radius: 14px; padding: 12px 14px; border: 1px solid #e2e8f0; }
        .metric span { color: var(--muted); font-size: 13px; }
        .metric strong { display: block; font-size: 20px; margin-top: 6px; }
        form { display: grid; gap: 12px; }
        label { font-weight: 600; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid #cbd5e1; font-size: 15px; }
        input:focus, select:focus { outline: 2px solid rgba(249, 115, 22, 0.25); border-color: var(--accent); }
        button { background: var(--accent); color: #fff; border: none; border-radius: 12px; padding: 10px 14px; font-weight: 700; cursor: pointer; }
        button:hover { background: var(--accent-dark); }
        .message { background: #fef3c7; border-left: 4px solid #d97706; padding: 12px 14px; border-radius: 10px; color: #92400e; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px 8px; text-align: left; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
        th { font-size: 12px; letter-spacing: 0.05em; text-transform: uppercase; color: var(--muted); }
        .empty { color: var(--muted); font-style: italic; }
        .pill { display: inline-flex; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 600; background: #e2e8f0; color: #334155; }
        .status-REQUESTED { background: #fef9c3; color: #a16207; }
        .status-ASSIGNED { background: #e0f2fe; color: #0369a1; }
        .status-PICKED_UP { background: #dcfce7; color: #166534; }
        .status-IN_TRANSIT { background: #fde68a; color: #b45309; }
        .status-DELIVERED { background: #bbf7d0; color: #15803d; }
        .status-CANCELED { background: #fee2e2; color: #b91c1c; }
        .driver-AVAILABLE { background: #dcfce7; color: #166534; }
        .driver-ON_DELIVERY { background: #ffe4e6; color: #9f1239; }
        .driver-OFFLINE { background: #e2e8f0; color: #334155; }
        .inline-form { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .inline-form select { min-width: 140px; }
        .hint { color: var(--muted); font-size: 13px; margin: 4px 0 0; }
        @keyframes floatIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 720px) {
            .hero h1 { font-size: 26px; }
            table, thead, tbody, th, td, tr { display: block; }
            thead { display: none; }
            tr { margin-bottom: 14px; border: 1px solid #e2e8f0; border-radius: 14px; padding: 12px; background: #fff; }
            td { border-bottom: none; padding: 6px 0; }
        }
    </style>
</head>
<body>
<div class="page">
    <div class="hero">
        <h1>Local Delivery Service POC</h1>
        <p>Simulate neighborhood delivery dispatching with orders, drivers, and status updates. Data lives in-memory and resets on restart.</p>
        <span class="badge">UI + JSON API</span>
        <div class="metrics">
            <div class="metric">
                <span>Total orders</span>
                <strong th:text="${metrics.totalOrders}">0</strong>
            </div>
            <div class="metric">
                <span>Active orders</span>
                <strong th:text="${metrics.activeOrders}">0</strong>
            </div>
            <div class="metric">
                <span>Unassigned</span>
                <strong th:text="${metrics.unassignedOrders}">0</strong>
            </div>
            <div class="metric">
                <span>Drivers available</span>
                <strong th:text="${metrics.availableDrivers}">0</strong>
            </div>
            <div class="metric">
                <span>Drivers on delivery</span>
                <strong th:text="${metrics.onDeliveryDrivers}">0</strong>
            </div>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Create delivery order</h2>
            <form th:action="@{/orders}" method="post">
                <div>
                    <label for="orderId">Order id</label>
                    <input id="orderId" name="id" type="text" placeholder="order:1024" maxlength="64" required>
                    <div class="hint">Allowed: letters, numbers, ., -, _, :</div>
                </div>
                <div>
                    <label for="customerName">Customer name</label>
                    <input id="customerName" name="customerName" type="text" placeholder="Jamie Park" maxlength="120" required>
                </div>
                <div>
                    <label for="pickupAddress">Pickup address</label>
                    <input id="pickupAddress" name="pickupAddress" type="text" placeholder="47 Market St" maxlength="200" required>
                </div>
                <div>
                    <label for="dropoffAddress">Dropoff address</label>
                    <input id="dropoffAddress" name="dropoffAddress" type="text" placeholder="12 Pine Ave" maxlength="200" required>
                </div>
                <div>
                    <label for="zone">Zone</label>
                    <input id="zone" name="zone" type="text" placeholder="Downtown" maxlength="60" required>
                </div>
                <div>
                    <label for="size">Package size</label>
                    <select id="size" name="size" required>
                        <option th:each="size : ${sizes}" th:value="${size}" th:text="${size}" th:selected="${size.name()} == 'MEDIUM'"></option>
                    </select>
                </div>
                <div>
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority" required>
                        <option th:each="priority : ${priorities}" th:value="${priority}" th:text="${priority}" th:selected="${priority.name()} == 'STANDARD'"></option>
                    </select>
                </div>
                <div>
                    <button type="submit">Save order</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Add delivery driver</h2>
            <form th:action="@{/drivers}" method="post">
                <div>
                    <label for="driverId">Driver id</label>
                    <input id="driverId" name="id" type="text" placeholder="driver:lucas" maxlength="64" required>
                </div>
                <div>
                    <label for="driverName">Driver name</label>
                    <input id="driverName" name="name" type="text" placeholder="Lucas Wang" maxlength="120" required>
                </div>
                <div>
                    <label for="vehicleType">Vehicle</label>
                    <input id="vehicleType" name="vehicleType" type="text" placeholder="Scooter" maxlength="80" required>
                </div>
                <div>
                    <label for="driverStatus">Status</label>
                    <select id="driverStatus" name="status" required>
                        <option th:each="status : ${driverStatuses}" th:value="${status}" th:text="${status}" th:selected="${status.name()} == 'AVAILABLE'"></option>
                    </select>
                </div>
                <div>
                    <button type="submit">Save driver</button>
                </div>
            </form>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Assign driver</h2>
            <form th:action="@{/assignments}" method="post">
                <div>
                    <label for="assignOrder">Order id</label>
                    <input id="assignOrder" name="orderId" type="text" placeholder="order:1024" required>
                </div>
                <div>
                    <label for="assignDriver">Driver id</label>
                    <input id="assignDriver" name="driverId" type="text" placeholder="driver:lucas" required>
                </div>
                <div>
                    <label for="etaMinutes">ETA minutes</label>
                    <input id="etaMinutes" name="etaMinutes" type="number" min="5" step="1" placeholder="25" required>
                </div>
                <div>
                    <button type="submit">Assign</button>
                </div>
            </form>
        </div>

        <div class="card" th:if="${message}">
            <h2>Dispatch log</h2>
            <div class="message" th:text="${message}"></div>
        </div>
    </div>

    <div class="card">
        <h2>Live orders</h2>
        <div th:if="${#lists.isEmpty(orders)}" class="empty">No orders yet. Create one to get started.</div>
        <table th:if="${!#lists.isEmpty(orders)}">
            <thead>
            <tr>
                <th>Order</th>
                <th>Route</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Driver</th>
                <th>ETA</th>
                <th>Update</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="order : ${orders}">
                <td>
                    <div class="pill" th:text="${order.id}">id</div>
                    <div th:text="${order.customerName}">name</div>
                    <div class="hint" th:text="${order.zone}">Zone</div>
                </td>
                <td>
                    <div th:text="${order.pickupAddress}">pickup</div>
                    <div class="hint" th:text="${order.dropoffAddress}">dropoff</div>
                </td>
                <td>
                    <div class="pill" th:text="${order.priority}">priority</div>
                    <div class="hint" th:text="${order.size}">size</div>
                </td>
                <td>
                    <div class="pill" th:classappend="' status-' + ${order.status}" th:text="${order.status}">status</div>
                </td>
                <td>
                    <div th:if="${order.driverId}" class="pill" th:text="${order.driverId}">driver</div>
                    <div th:if="${order.driverId == null}" class="empty">Unassigned</div>
                </td>
                <td>
                    <div th:text="${order.etaMinutes != null ? order.etaMinutes + ' min' : '--'}">--</div>
                </td>
                <td>
                    <form class="inline-form" th:action="@{'/orders/' + ${order.id} + '/status'}" method="post">
                        <select name="status" required>
                            <option th:each="status : ${statuses}" th:value="${status}" th:text="${status}" th:selected="${status} == ${order.status}"></option>
                        </select>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>Drivers</h2>
        <div th:if="${#lists.isEmpty(drivers)}" class="empty">No drivers yet. Add a driver to dispatch orders.</div>
        <table th:if="${!#lists.isEmpty(drivers)}">
            <thead>
            <tr>
                <th>Driver</th>
                <th>Vehicle</th>
                <th>Status</th>
                <th>Active order</th>
                <th>Completed</th>
                <th>Update</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="driver : ${drivers}">
                <td>
                    <div class="pill" th:text="${driver.id}">id</div>
                    <div th:text="${driver.name}">name</div>
                </td>
                <td th:text="${driver.vehicleType}">vehicle</td>
                <td>
                    <div class="pill" th:classappend="' driver-' + ${driver.status}" th:text="${driver.status}">status</div>
                </td>
                <td>
                    <div th:if="${driver.activeOrderId}" class="pill" th:text="${driver.activeOrderId}">order</div>
                    <div th:if="${driver.activeOrderId == null}" class="empty">--</div>
                </td>
                <td th:text="${driver.completedDeliveries}">0</td>
                <td>
                    <form class="inline-form" th:action="@{'/drivers/' + ${driver.id} + '/status'}" method="post">
                        <select name="status" required>
                            <option th:each="status : ${driverStatuses}" th:value="${status}" th:text="${status}" th:selected="${status} == ${driver.status}"></option>
                        </select>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
