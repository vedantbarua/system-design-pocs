<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Uber POC</title>
    <style>
        :root {
            --ink: #0f172a;
            --muted: #475569;
            --accent: #10b981;
            --accent-dark: #059669;
            --accent-soft: #d1fae5;
            --bg: radial-gradient(circle at 20% 20%, rgba(16, 185, 129, 0.15), transparent 45%),
                  radial-gradient(circle at 80% 0%, rgba(56, 189, 248, 0.2), transparent 40%),
                  linear-gradient(140deg, #f8fafc 0%, #e2e8f0 100%);
            --card: #ffffff;
            --shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
        }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: "Space Grotesk", "IBM Plex Sans", "Segoe UI", system-ui, sans-serif; background: var(--bg); color: var(--ink); }
        .page { max-width: 1200px; margin: 0 auto; padding: 32px 20px 60px; }
        .hero { background: var(--card); border-radius: 22px; padding: 28px 30px; box-shadow: var(--shadow); animation: floatIn 0.6s ease both; }
        .hero h1 { margin: 0 0 8px; font-size: 34px; }
        .hero p { margin: 0; color: var(--muted); max-width: 680px; }
        .badge { display: inline-flex; align-items: center; gap: 8px; margin-top: 14px; padding: 6px 12px; border-radius: 999px; background: var(--accent-soft); color: #065f46; font-weight: 600; font-size: 13px; }
        .grid { display: grid; gap: 20px; margin-top: 24px; }
        .grid.two { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
        .grid.three { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
        .card { background: var(--card); border-radius: 18px; padding: 20px 22px; box-shadow: var(--shadow); animation: floatIn 0.7s ease both; }
        .card h2 { margin: 0 0 10px; font-size: 20px; }
        .metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-top: 16px; }
        .metric { background: #f8fafc; border-radius: 14px; padding: 12px 14px; border: 1px solid #e2e8f0; }
        .metric span { color: var(--muted); font-size: 13px; }
        .metric strong { display: block; font-size: 20px; margin-top: 6px; }
        form { display: grid; gap: 12px; }
        label { font-weight: 600; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid #cbd5e1; font-size: 15px; }
        input:focus, select:focus { outline: 2px solid rgba(16, 185, 129, 0.25); border-color: var(--accent); }
        button { background: var(--accent); color: #fff; border: none; border-radius: 12px; padding: 10px 14px; font-weight: 700; cursor: pointer; }
        button:hover { background: var(--accent-dark); }
        .message { background: #ecfeff; border-left: 4px solid #14b8a6; padding: 12px 14px; border-radius: 10px; color: #0f766e; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px 8px; text-align: left; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
        th { font-size: 12px; letter-spacing: 0.05em; text-transform: uppercase; color: var(--muted); }
        .empty { color: var(--muted); font-style: italic; }
        .pill { display: inline-flex; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 600; background: #e2e8f0; color: #334155; }
        .status-REQUESTED { background: #fef9c3; color: #a16207; }
        .status-MATCHED { background: #dbeafe; color: #1d4ed8; }
        .status-EN_ROUTE { background: #fee2e2; color: #b91c1c; }
        .status-IN_PROGRESS { background: #e0f2fe; color: #0369a1; }
        .status-COMPLETED { background: #dcfce7; color: #166534; }
        .status-CANCELED { background: #fee2e2; color: #b91c1c; }
        .driver-AVAILABLE { background: #dcfce7; color: #166534; }
        .driver-ON_TRIP { background: #fde68a; color: #92400e; }
        .driver-OFFLINE { background: #e2e8f0; color: #334155; }
        .inline-form { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .inline-form select { min-width: 150px; }
        .hint { color: var(--muted); font-size: 13px; margin: 4px 0 0; }
        @keyframes floatIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 720px) {
            .hero h1 { font-size: 26px; }
            table, thead, tbody, th, td, tr { display: block; }
            thead { display: none; }
            tr { margin-bottom: 14px; border: 1px solid #e2e8f0; border-radius: 14px; padding: 12px; background: #fff; }
            td { border-bottom: none; padding: 6px 0; }
        }
    </style>
</head>
<body>
<div class="page">
    <div class="hero">
        <h1>Uber POC</h1>
        <p>Simulate ride-hailing dispatch with riders, drivers, trip requests, matching, and fare estimates. Everything is in-memory and resets on restart.</p>
        <span class="badge">UI + JSON API</span>
        <div class="metrics">
            <div class="metric">
                <span>Total riders</span>
                <strong th:text="${metrics.totalRiders}">0</strong>
            </div>
            <div class="metric">
                <span>Total drivers</span>
                <strong th:text="${metrics.totalDrivers}">0</strong>
            </div>
            <div class="metric">
                <span>Available drivers</span>
                <strong th:text="${metrics.availableDrivers}">0</strong>
            </div>
            <div class="metric">
                <span>On-trip drivers</span>
                <strong th:text="${metrics.onTripDrivers}">0</strong>
            </div>
            <div class="metric">
                <span>Total trips</span>
                <strong th:text="${metrics.totalTrips}">0</strong>
            </div>
            <div class="metric">
                <span>Active trips</span>
                <strong th:text="${metrics.activeTrips}">0</strong>
            </div>
        </div>
    </div>

    <div class="grid three">
        <div class="card">
            <h2>Create rider</h2>
            <form th:action="@{/riders}" method="post">
                <div>
                    <label for="riderId">Rider id</label>
                    <input id="riderId" name="id" type="text" placeholder="rider:maya" maxlength="64" required>
                    <div class="hint">Allowed: letters, numbers, ., -, _, :</div>
                </div>
                <div>
                    <label for="riderName">Name</label>
                    <input id="riderName" name="name" type="text" placeholder="Maya Ortiz" maxlength="120" required>
                </div>
                <div>
                    <label for="riderRating">Rating</label>
                    <input id="riderRating" name="rating" type="number" step="0.1" min="1" max="5" value="4.8" required>
                </div>
                <div>
                    <label for="homeZone">Home zone</label>
                    <input id="homeZone" name="homeZone" type="text" placeholder="Downtown" maxlength="60" required>
                </div>
                <div>
                    <button type="submit">Save rider</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Add driver</h2>
            <form th:action="@{/drivers}" method="post">
                <div>
                    <label for="driverId">Driver id</label>
                    <input id="driverId" name="id" type="text" placeholder="driver:lucas" maxlength="64" required>
                </div>
                <div>
                    <label for="driverName">Name</label>
                    <input id="driverName" name="name" type="text" placeholder="Lucas Wang" maxlength="120" required>
                </div>
                <div>
                    <label for="vehicle">Vehicle</label>
                    <input id="vehicle" name="vehicle" type="text" placeholder="Tesla Model 3" maxlength="80" required>
                </div>
                <div>
                    <label for="driverRating">Rating</label>
                    <input id="driverRating" name="rating" type="number" step="0.1" min="1" max="5" value="4.9" required>
                </div>
                <div>
                    <label for="driverZone">Zone</label>
                    <input id="driverZone" name="zone" type="text" placeholder="Downtown" maxlength="60" required>
                </div>
                <div>
                    <label for="driverStatus">Status</label>
                    <select id="driverStatus" name="status" required>
                        <option th:each="status : ${driverStatuses}" th:value="${status}" th:text="${status}" th:selected="${status.name()} == 'AVAILABLE'"></option>
                    </select>
                </div>
                <div>
                    <button type="submit">Save driver</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Request trip</h2>
            <form th:action="@{/trips}" method="post">
                <div>
                    <label for="tripId">Trip id</label>
                    <input id="tripId" name="id" type="text" placeholder="trip:204" maxlength="64" required>
                </div>
                <div>
                    <label for="tripRider">Rider id</label>
                    <input id="tripRider" name="riderId" type="text" placeholder="rider:maya" maxlength="64" required>
                </div>
                <div>
                    <label for="pickupAddress">Pickup address</label>
                    <input id="pickupAddress" name="pickupAddress" type="text" placeholder="12 Market St" maxlength="200" required>
                </div>
                <div>
                    <label for="dropoffAddress">Dropoff address</label>
                    <input id="dropoffAddress" name="dropoffAddress" type="text" placeholder="98 Pine Ave" maxlength="200" required>
                </div>
                <div>
                    <label for="tripZone">Zone</label>
                    <input id="tripZone" name="zone" type="text" placeholder="Downtown" maxlength="60" required>
                </div>
                <div>
                    <label for="product">Product</label>
                    <select id="product" name="product" required>
                        <option th:each="product : ${products}" th:value="${product}" th:text="${product.label}" th:selected="${product.name()} == 'UBER_X'"></option>
                    </select>
                </div>
                <div>
                    <label for="distanceKm">Distance (km)</label>
                    <input id="distanceKm" name="distanceKm" type="number" step="0.1" min="0.1" placeholder="5.6" required>
                </div>
                <div>
                    <button type="submit">Request trip</button>
                </div>
            </form>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Match driver</h2>
            <form th:action="@{/assignments}" method="post">
                <div>
                    <label for="assignTrip">Trip id</label>
                    <input id="assignTrip" name="tripId" type="text" placeholder="trip:204" required>
                </div>
                <div>
                    <label for="assignDriver">Driver id</label>
                    <input id="assignDriver" name="driverId" type="text" placeholder="driver:lucas" required>
                </div>
                <div>
                    <button type="submit">Assign</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Update trip status</h2>
            <form th:action="@{/trips/status}" method="post" class="inline-form">
                <label for="statusTripId">Trip id</label>
                <input id="statusTripId" name="tripId" type="text" placeholder="trip:204" required>
                <label for="tripStatus">Status</label>
                <select id="tripStatus" name="status" required>
                    <option th:each="status : ${tripStatuses}" th:value="${status}" th:text="${status}"></option>
                </select>
                <button type="submit">Update</button>
            </form>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Update driver status</h2>
            <form th:action="@{/drivers/status}" method="post" class="inline-form">
                <label for="statusDriverId">Driver id</label>
                <input id="statusDriverId" name="driverId" type="text" placeholder="driver:lucas" required>
                <label for="driverStatusUpdate">Status</label>
                <select id="driverStatusUpdate" name="status" required>
                    <option th:each="status : ${driverStatuses}" th:value="${status}" th:text="${status}"></option>
                </select>
                <button type="submit">Update</button>
            </form>
        </div>

        <div class="card" th:if="${message}">
            <h2>Dispatch log</h2>
            <div class="message" th:text="${message}"></div>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Trips</h2>
            <div th:if="${trips.isEmpty()}" class="empty">No trips yet. Create a rider and request a trip.</div>
            <table th:if="${!trips.isEmpty()}">
                <thead>
                <tr>
                    <th>Trip</th>
                    <th>Rider</th>
                    <th>Driver</th>
                    <th>Zone</th>
                    <th>Product</th>
                    <th>Distance</th>
                    <th>Surge</th>
                    <th>Fare</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="trip : ${trips}">
                    <td th:text="${trip.id}"></td>
                    <td th:text="${trip.riderId}"></td>
                    <td th:text="${trip.driverId != null ? trip.driverId : 'Unassigned'}"></td>
                    <td th:text="${trip.zone}"></td>
                    <td th:text="${trip.product.label}"></td>
                    <td th:text="${trip.distanceKm}"></td>
                    <td th:text="${trip.surgeMultiplier}"></td>
                    <td th:text="${'$' + trip.estimatedFare}"></td>
                    <td><span class="pill" th:classappend="' status-' + ${trip.status}" th:text="${trip.status}"></span></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>Drivers</h2>
            <div th:if="${drivers.isEmpty()}" class="empty">No drivers yet. Add a driver to start matching.</div>
            <table th:if="${!drivers.isEmpty()}">
                <thead>
                <tr>
                    <th>Driver</th>
                    <th>Vehicle</th>
                    <th>Rating</th>
                    <th>Zone</th>
                    <th>Status</th>
                    <th>Active Trip</th>
                    <th>Completed</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="driver : ${drivers}">
                    <td>
                        <div th:text="${driver.name}"></div>
                        <div class="hint" th:text="${driver.id}"></div>
                    </td>
                    <td th:text="${driver.vehicle}"></td>
                    <td th:text="${driver.rating}"></td>
                    <td th:text="${driver.currentZone}"></td>
                    <td><span class="pill" th:classappend="' driver-' + ${driver.status}" th:text="${driver.status}"></span></td>
                    <td th:text="${driver.activeTripId != null ? driver.activeTripId : 'â€”'}"></td>
                    <td th:text="${driver.completedTrips}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="grid two">
        <div class="card">
            <h2>Riders</h2>
            <div th:if="${riders.isEmpty()}" class="empty">No riders yet. Create a rider to request trips.</div>
            <table th:if="${!riders.isEmpty()}">
                <thead>
                <tr>
                    <th>Rider</th>
                    <th>Rating</th>
                    <th>Home Zone</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="rider : ${riders}">
                    <td>
                        <div th:text="${rider.name}"></div>
                        <div class="hint" th:text="${rider.id}"></div>
                    </td>
                    <td th:text="${rider.rating}"></td>
                    <td th:text="${rider.homeZone}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
</html>
